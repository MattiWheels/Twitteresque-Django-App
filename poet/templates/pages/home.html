{% extends 'base.html' %}

{% block title %}
~ Poet ~
{% endblock %}

{% block content %}

<div class="row text-center mt-3">
    <div class="column">
        <p>Welcome to poet ~ An experimental, (& what will be a) twitter-like
        environment. Based on <a href="https://youtu.be/f1R_bykXHGE">this tutorial</a>.
        </p>
    </div>
</div>

<div id="notions">
    Loading...
</div>

<script>
const notionsElement = document.getElementById("notions") // select html element

const xhr = new XMLHttpRequest()
const method = "GET"
const url = "/notions"
const responseType = "json"

function handleDidLike(notion_id, currentCount ) {
    console.log(notion_id, currentCount)
}

function likeButton(notion) {
    return "<button class='btn btn-primary btn-sm' onclick='handleDidLike(" +
    notion.id + ", " + notion.likes + ")'>" + notion.likes + "&nbsp;Like</button>"
}

function formatNotionElement(notion) {
    var formattedNotion = "<div class='col-12 col-md-10 rounded mx-auto mb-4 p-4 border bg-dark text-light tweet' id='tweet-" + notion.id + "'>"
        + "<p>" + notion.content + "</p><div class='btn-group'>" +
        likeButton(notion) + "</div></div>"
    return formattedNotion
}

xhr.responseType = responseType
xhr.open(method, url)
xhr.onload = function() {
    const serverResponse = xhr.response
    var listedItems = serverResponse.response
    var finalNotionStr = ""
    var i

    for (i=0;i<listedItems.length;i++) {
        var notionObj = listedItems[i]
        var current = formatNotionElement(notionObj)
        finalNotionStr += current
    }

    notionsElement.innerHTML = finalNotionStr
}
xhr.send()

</script>
{% endblock %}
